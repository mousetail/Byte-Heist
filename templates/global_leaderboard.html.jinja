{% extends "base/base.html.jinja" %}
{% block content %}
  <div class="flex flex-col gap-4">
    <div class="flex justify-between items-center">
      <div>
        <h1 class="text-3xl font-bold text-white">Leaderboard</h1>
        <p class="text-byte-brown-200">
          The most skilled code crackers who've pulled off the perfect heist with
          minimal code.
        </p>
      </div>
    </div>
    <div class="flex flex-col sm:flex-row gap-4 mt-4">
      <div class="relative flex-grow flex">
        {% include "icons/magnifying-glass.svg" %}
        <input type="search"
               placeholder="Search users..."
               class="w-full pl-8 pr-4 py-2 bg-byte-brown-700 border border-byte-brown-500 text-white placeholder:text-byte-brown-200 rounded-md focus:outline-none focus:ring-2 focus:ring-green-700" />
      </div>
    </div>
    <!-- Top 3 Cards -->
    {% if object.entries and object.entries | length >= 3 %}
      <div class="grid grid-cols-1 gap-6 mt-6">
        <!-- First Place -->
        <div class="bg-amber-100 dark:bg-amber-950/50 border border-amber-200 dark:border-amber-800 rounded-lg p-6">
          <div class="text-center">
            <div class="flex justify-center items-center gap-2 mb-4">
              {% include "icons/Cup-First--Streamline-Solar.svg" %}
              <span class="font-bold text-amber-600">1st Place</span>
            </div>
            <div class="h-20 w-20 mx-auto border-4 border-amber-300 rounded-full overflow-hidden">
              <img src="{{ object.entries[0].author_avatar }}&size=80"
                   alt="{{ object.entries[0].author_name }}"
                   class="w-full h-full object-cover" />
            </div>
            <h3 class="mt-4 text-xl font-bold text-slate-900 dark:text-white">{{ object.entries[0].author_name }}</h3>
            <p class="text-slate-600 dark:text-slate-400">{{ object.entries[0].total_score | format_number }} points</p>
            <div class="flex justify-center gap-2 mt-2">
              <span class="bg-amber-100 dark:bg-amber-900 text-amber-800 dark:text-amber-200 text-xs px-2 py-1 rounded border border-amber-200 dark:border-amber-800">
                {{ object.entries[0].solutions }} heists
              </span>
              <span class="bg-amber-100 dark:bg-amber-900 text-amber-800 dark:text-amber-200 text-xs px-2 py-1 rounded border border-amber-200 dark:border-amber-800">
                {{ object.entries[0].first_places }} 1st places
              </span>
            </div>
          </div>
        </div>
        <!-- Second and Third Place Container -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Second Place -->
          <div class="bg-green-50 dark:bg-green-950/50 border border-green-200 dark:border-green-800 rounded-lg p-6">
            <div class="text-center">
              <div class="flex justify-center items-center gap-2 mb-4">
                {% include "icons/Medal-Ribbons-Star--Streamline-Solar.svg" %}
                <span class="font-bold text-green-600">2nd Place</span>
              </div>
              <div class="h-20 w-20 mx-auto border-4 border-green-300 rounded-full overflow-hidden">
                <img src="{{ object.entries[1].author_avatar }}&size=80"
                     alt="{{ object.entries[1].author_name }}"
                     class="w-full h-full object-cover" />
              </div>
              <h3 class="mt-4 text-xl font-bold text-slate-900 dark:text-white">{{ object.entries[1].author_name }}</h3>
              <p class="text-slate-600 dark:text-slate-400">{{ object.entries[1].total_score | format_number }} points</p>
              <div class="flex justify-center gap-2 mt-2">
                <span class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs px-2 py-1 rounded border border-green-200 dark:border-green-800">
                  {{ object.entries[1].solutions }} heists
                </span>
                <span class="bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200 text-xs px-2 py-1 rounded border border-green-200 dark:border-green-800">
                  {{ object.entries[1].first_places }} 1st places
                </span>
              </div>
            </div>
          </div>
          <!-- Third Place -->
          <div class="bg-amber-50 dark:bg-amber-950/50 border border-amber-200 dark:border-amber-800 rounded-lg p-6">
            <div class="text-center">
              <div class="flex justify-center items-center gap-2 mb-4">
                {% include "icons/Medal-Ribbons-Star--Streamline-Solar.svg" %}
                <span class="font-bold text-amber-600">3rd Place</span>
              </div>
              <div class="h-20 w-20 mx-auto border-4 border-amber-300 rounded-full overflow-hidden">
                <img src="{{ object.entries[2].author_avatar }}&size=80"
                     alt="{{ object.entries[2].author_name }}"
                     class="w-full h-full object-cover" />
              </div>
              <h3 class="mt-4 text-xl font-bold text-slate-900 dark:text-white">{{ object.entries[2].author_name }}</h3>
              <p class="text-slate-600 dark:text-slate-400">{{ object.entries[2].total_score | format_number }} points</p>
              <div class="flex justify-center gap-2 mt-2">
                <span class="bg-amber-100 dark:bg-amber-900 text-amber-800 dark:text-amber-200 text-xs px-2 py-1 rounded border border-amber-200 dark:border-amber-800">
                  {{ object.entries[2].solutions }} heists
                </span>
                <span class="bg-amber-100 dark:bg-amber-900 text-amber-800 dark:text-amber-200 text-xs px-2 py-1 rounded border border-amber-200 dark:border-amber-800">
                  {{ object.entries[2].first_places }} first places
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
    <!-- Tabs -->
    <div class="mt-6">
      <div class="bg-byte-brown-700 border border-byte-brown-500 rounded-lg p-1 flex w-fit">
        <a href="/leaderboard/code-golf"
           class="px-6 py-2 text-sm font-medium
                  {% if object.category=='code-golf' %}
                    text-white bg-green-900
                  {% else %}
                    text-byte-brown-200 hover:text-white
                  {% endif %}
                  rounded-md transition-colors">Code Golf</a>
        <a href="/leaderboard/restricted-source"
           class="px-6 py-2 text-sm font-medium
                  {% if object.category=='restricted-source' %}
                    text-white bg-green-900
                  {% else %}
                    text-byte-brown-200 hover:text-white
                  {% endif %}
                  rounded-md transition-colors">Restricted Source</a>
      </div>
      <div class="bg-byte-brown-700 border border-byte-brown-500 rounded-lg p-1 flex w-fit">
        <a href="/leaderboard/{{ object.category }}"
           class="px-6 py-2 text-sm font-medium
                  {% if not object.language %}
                    text-white bg-green-900
                  {% else %}
                    text-byte-brown-200 hover:text-white
                  {% endif %}
                  rounded-md transition-colors">All</a>
        {% for lang, lang_data in languages() %}
          <a href="/leaderboard/{{ object.category }}/{{ lang }}"
             class="px-6 py-2 text-sm font-medium
                    {% if object.language==lang %}
                      text-white bg-green-900
                    {% else %}
                      text-byte-brown-200 hover:text-white
                    {% endif %}
                    rounded-md transition-colors">{{ lang_data.displayName }}</a>
        {% endfor %}
      </div>
    </div>
    <!-- Leaderboard Table -->
    <div class="mt-4">
      <div class="bg-byte-brown-700 border border-byte-brown-500 rounded-lg overflow-hidden">
        <div class="overflow-auto">
          <table class="w-full">
            <thead>
              <tr class="border-b border-byte-brown-500">
                <th class="text-left p-4 font-medium text-white">Rank</th>
                <th class="text-left p-4 font-medium text-white">User</th>
                <th class="text-left p-4 font-medium text-white">
                  <a href="/doc/scoring.md" class="underline">Score</a>
                </th>
                <th class="text-left p-4 font-medium text-white">Heists</th>
                <th class="text-left p-4 font-medium text-white">First Places</th>
                {# <th class="text-left p-4 font-medium text-white">Change</th> #}
              </tr>
            </thead>
            <tbody>
              {% for solution in object.entries %}
                <tr class="border-b border-byte-brown-500 hover:bg-byte-brown-500/50 transition-colors">
                  <td class="p-4">
                    <div class="flex items-center gap-2">
                      {% if loop.index == 1 %}
                        {% include "icons/Cup-First--Streamline-Solar.svg" %}
                      {% elif loop.index == 2 %}
                        {% include "icons/Medal-Ribbons-Star--Streamline-Solar.svg" %}
                      {% elif loop.index == 3 %}
                        {% include "icons/Medal-Ribbons-Star--Streamline-Solar.svg" %}
                      {% else %}
                        <span class="text-white">{{ loop.index }}</span>
                      {% endif %}
                    </div>
                  </td>
                  <td class="p-4">
                    <div class="flex items-center gap-2">
                      <div class="h-8 w-8 rounded-full overflow-hidden">
                        <img src="{{ solution.author_avatar }}&size=32"
                             alt="{{ solution.author_name }}"
                             class="w-full h-full object-cover" />
                      </div>
                      <div>
                        <div class="font-medium text-white">
                          <a href="/user/{{ solution.author_id }}"
                             class="hover:text-byte-green-400 transition-colors">{{ solution.author_name }}</a>
                        </div>
                        <div class="text-xs text-byte-brown-200">Joined {{ solution.author_join_date | format_date(include_day=false) }}</div>
                      </div>
                    </div>
                  </td>
                  <td class="p-4 text-white">{{ solution.total_score | format_number }}</td>
                  <td class="p-4 text-white">{{ solution.solutions }}</td>
                  <td class="p-4 text-white">{{ solution.first_places }}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
    {% if not object.entries %}
      <div class="text-center py-12">
        <div class="text-byte-brown-200 text-lg">No leaderboard data available yet.</div>
      </div>
    {% endif %}
  </div>
{% endblock content %}
